<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.16: http://docutils.sourceforge.net/" />
<title>NIOS Remmote Console Commands</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="nios-remmote-console-commands">
<h1 class="title">NIOS Remmote Console Commands</h1>

<div class="line-block">
<div class="line">Version: 0.2.2</div>
<div class="line">Author: Chris Marrison</div>
<div class="line">Email: <a class="reference external" href="mailto:chris&#64;infoblox.com">chris&#64;infoblox.com</a></div>
</div>
<div class="section" id="description">
<h1>Description</h1>
<p>Demo NIOS script to execute remote (ssh) console commands using pexpect.
The script allows for the execution of show commands, shutdown/reboot, and
set promote_master.</p>
<p>It is implemented as a library or for use as a CLI that can be called, for
example, via the ansible command module.</p>
</div>
<div class="section" id="prerequisites">
<h1>Prerequisites</h1>
<p>Python 3.7+</p>
<div class="section" id="installing-python">
<h2>Installing Python</h2>
<p>You can install the latest version of Python 3.x by downloading the appropriate
installer for your system from <a class="reference external" href="https://python.org">python.org</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are running MacOS Catalina (or later) Python 3 comes pre-installed.
Previous versions only come with Python 2.x by default and you will therefore
need to install Python 3 as above or via Homebrew, Ports, etc.</p>
<p>By default the python command points to Python 2.x, you can check this using
the command:</p>
<pre class="literal-block">
$ python -V
</pre>
<p>To specifically run Python 3, use the command:</p>
<pre class="last literal-block">
$ python3
</pre>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>Mac users will need the xcode command line utilities installed to use pip3,
etc. If you need to install these use the command:</p>
<pre class="last literal-block">
$ xcode-select --install
</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are installing Python on Windows, be sure to check the box to have
Python added to your PATH if the installer offers such an option
(it's normally off by default).</p>
</div>
</div>
<div class="section" id="modules">
<h2>Modules</h2>
<p>Non-standard modules:</p>
<blockquote>
<ul class="simple">
<li>pexpect</li>
</ul>
</blockquote>
<p>Complete list of modules:</p>
<pre class="literal-block">
import logging
import sys
import argparse
import configparser
import pexpect
</pre>
</div>
</div>
<div class="section" id="installation">
<h1>Installation</h1>
<p>The simplest way to install and maintain the tools is to clone this
repository:</p>
<pre class="literal-block">
% git clone https://github.com/ccmarris/nios_console_cmds
</pre>
<p>Alternative you can download as a Zip file.</p>
</div>
<div class="section" id="basic-configuration">
<h1>Basic Configuration</h1>
<p>The script utilise a the same gm.ini file format as the demo nios api scripts
for simplicity. However, since this connects to a specified member via remote
console, this is used only for administrator credentials.</p>
<div class="section" id="gm-ini">
<h2>gm.ini</h2>
<p>The <em>gm.ini</em> file is used by the scripts to define the details to connect to
to Grid Master. A sample inifile is provided and follows the following
format:</p>
<pre class="literal-block">
[NIOS]
gm = '192.168.1.10'
api_version = 'v2.12'
valid_cert = 'false'
user = 'admin'
pass = 'infoblox'
</pre>
<p>You can use either an IP or hostname for the Grid Master. This inifile
should be kept in a safe area of your filesystem.</p>
<p>Use the --config/-c option to override the default ini file.</p>
</div>
</div>
<div class="section" id="usage">
<h1>Usage</h1>
<p>The script support -h or --help on the command line to access the options
available:</p>
<pre class="literal-block">
% ./nios_console_cmds.py --help
usage: nios_console_cmds.py [-h] [-c CONFIG] -m MEMBER -C COMMAND [-p] [-D DELAY] [-d]

NIOS Remote Comsole Access

optional arguments:
  -h, --help            show this help message and exit
  -c CONFIG, --config CONFIG
                        Overide Config file
  -m MEMBER, --member MEMBER
                        Name or IP of Grid Member
  -C COMMAND, --command COMMAND
                        show command or promote_master
  -p, --promote         Promote GMC to GM
  -D DELAY, --delay DELAY
                        Set delay on promotion
  -d, --debug           Enable debug messages
</pre>
<div class="section" id="nios-console-cmds">
<h2>nios_console_cmds</h2>
</div>
</div>
<div class="section" id="examples">
<h1>Examples</h1>
<p>Run a show command against a Grid Member:</p>
<pre class="literal-block">
% ./nios_console_cmds.py --config gm.ini -m 10.10.10.10 --command 'show status'
</pre>
<p>Enable debug:</p>
<pre class="literal-block">
% ./nios_console_cmds.py --config gm.ini -m 10.10.10.10 --command 'show status' --debug
</pre>
<p>Reboot member:</p>
<pre class="literal-block">
% ./nios_console_cmds.py --config gm.ini -m 10.10.10.10 --command 'reboot' --yes
</pre>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Where a command needs a confirmation use --yes to send a confirmation to
proceed. Otherwise a no response will be sent in response to the command.</p>
</div>
</div>
<div class="section" id="promoting-a-gmc">
<h1>Promoting a GMC</h1>
<p>Promoting a GMC to GM, should always be performed after a concious decision
has been made to perform a promotion. The intention here is not to allow for
a fully automated promotion of a GMC.</p>
<p>To use the promotion function, a specific command <em>promote_master</em> is used.
An additional safeguard must also be used to enable the command by adding the
<em>--promote</em> option.</p>
<p>Examples:</p>
<pre class="literal-block">
% ./nios_console_cmds.py -c ~/configs/localgm.ini -m 10.101.101.101 -C 'promote_master'
WARNING:root:Safeguard prevented promotion


% ./nios_console_cmds.py -c ~/configs/localgm.ini -m 10.101.101.101 -C 'promote_master' --promote
ERROR: Promotion failed
ERROR:  set promote_master
Unable to promote:  This member is already the grid master


% ./nios_console_cmds.py -c ~/configs/localgm.ini -m 10.101.101.101 -C 'promote_master' --promote
</pre>
</div>
<div class="section" id="license">
<h1>License</h1>
<p>This project is licensed under the 2-Clause BSD License
- please see LICENSE file for details.</p>
</div>
<div class="section" id="aknowledgements">
<h1>Aknowledgements</h1>
<p>Thanks to Alex Del Rio for bringing the use case and to both Alex
and Steve Makousky for testing in their labs.</p>
</div>
</div>
</body>
</html>
